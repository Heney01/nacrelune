
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Default deny all reads and writes
    match /{document=**} {
      allow read, write: if false;
    }
    
    // Users can read their own user document
    match /users/{userId} {
      allow get: if request.auth != null && request.auth.uid == userId;
      // Public read for display name, photo, etc.
      allow list: if request.auth != null;
    }

    // Creations are public-readable
    match /creations/{creationId} {
      allow get: if true;
      allow list: if true;
    }

    // Jewelry models and charms are public-readable
    match /necklaces/{necklaceId} {
      allow get: if true;
    }
    match /bracelets/{braceletId} {
      allow get: if true;
    }
    match /earrings/{earringId} {
      allow get: if true;
    }
    match /charms/{charmId} {
        allow get: if true;
    }
    match /charmCategories/{categoryId} {
        allow get: if true;
    }

    // Allow logged-in users to like creations and creators
    match /creations/{creationId}/likes/{userId} {
       allow read, write: if request.auth != null && request.auth.uid == userId;
    }
     match /users/{creatorId}/likes/{userId} {
       allow read, write: if request.auth != null && request.auth.uid == userId;
    }
  }
}

